<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校友活动 - 南大校友</title>
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@2.1.0/dist/iconify-icon.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.5.19/vue.global.min.js"></script>
    <link rel="stylesheet" href="shared-styles.css">
    <style>
        /* 首页专用样式 */
        .home-page {
            background-color: #F8F9FA;
            min-height: 100vh;
        }

        .page-content {
            padding: 0;
            background-color: #F8F9FA;
        }

        /* 筛选标签区域 */
        .filter-section {
            background-color: var(--color-surface);
            padding: 12px var(--spacing-lg);
            border-bottom: 1px solid #F1F3F4;
        }

        .filter-tabs {
            display: flex;
            gap: var(--spacing-sm);
            max-width: 500px;
            overflow-x: auto;
            padding-bottom: var(--spacing-xs);
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .filter-tabs::-webkit-scrollbar {
            display: none;
        }

        .filter-tab {
            padding: 10px var(--spacing-md);
            background-color: #F8F9FA;
            color: var(--color-on-surface-variant);
            border: 2px solid transparent;
            border-radius: var(--radius-sm);
            font-size: var(--text-body-medium);
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
        }

        .filter-tab:hover {
            background-color: var(--color-primary-container);
            color: var(--color-on-primary-container);
        }

        .filter-tab.active {
            background-color: var(--color-primary);
            color: var(--color-on-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(112, 44, 138, 0.2);
        }

        .filter-icon {
            width: 16px;
            height: 16px;
        }

        /* 活动列表区域 */
        .activities-section {
            padding: var(--spacing-md);
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .activity-card {
            background-color: var(--color-surface);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #F1F3F4;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .activity-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            border-color: var(--color-primary-container);
        }

        .activity-image-container {
            position: relative;
            height: 180px;
            overflow: hidden;
        }

        .activity-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .activity-card:hover .activity-image {
            transform: scale(1.05);
        }

        .activity-status {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            padding: 4px var(--spacing-sm);
            border-radius: var(--radius-xs);
            font-size: var(--text-label-medium);
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .activity-status.open {
            background-color: rgba(76, 175, 80, 0.9);
            color: white;
        }

        .activity-status.full {
            background-color: rgba(255, 87, 34, 0.9);
            color: white;
        }

        .activity-status.closed {
            background-color: rgba(97, 97, 97, 0.9);
            color: white;
        }

        .activity-category {
            position: absolute;
            top: var(--spacing-md);
            left: var(--spacing-md);
            background-color: rgba(112, 44, 138, 0.9);
            color: white;
            padding: 4px var(--spacing-sm);
            border-radius: var(--radius-xs);
            font-size: var(--text-label-medium);
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .activity-info {
            padding: var(--spacing-lg);
        }

        .activity-title {
            font-size: var(--text-title-medium);
            font-weight: 600;
            color: var(--color-on-surface);
            margin-bottom: var(--spacing-sm);
            line-height: 1.4;
        }

        .activity-meta {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: var(--text-body-medium);
            color: var(--color-on-surface-variant);
        }

        .meta-icon {
            width: 16px;
            height: 16px;
            color: var(--color-primary);
        }

        .activity-summary {
            font-size: var(--text-body-medium);
            color: var(--color-on-surface-variant);
            line-height: 1.5;
            margin-bottom: var(--spacing-md);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .activity-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .participants-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: var(--text-body-medium);
            color: var(--color-on-surface-variant);
        }

        .view-btn {
            background-color: var(--color-primary-container);
            color: var(--color-on-primary-container);
            border: none;
            border-radius: var(--radius-sm);
            padding: var(--spacing-xs) var(--spacing-md);
            font-size: var(--text-label-large);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .view-btn:hover {
            background-color: var(--color-primary);
            color: var(--color-on-primary);
            transform: translateX(2px);
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xl) var(--spacing-lg);
            color: var(--color-on-surface-variant);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: var(--spacing-lg);
            opacity: 0.5;
        }

        .empty-title {
            font-size: var(--text-title-medium);
            font-weight: 500;
            margin-bottom: var(--spacing-sm);
            color: var(--color-on-surface);
        }

        .empty-message {
            font-size: var(--text-body-large);
            line-height: 1.5;
        }

        /* 加载骨架屏 */
        .activity-skeleton {
            background-color: var(--color-surface);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: var(--spacing-lg);
        }

        .skeleton-image {
            height: 180px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        .skeleton-content {
            padding: var(--spacing-lg);
        }

        .skeleton-line {
            height: 16px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
            margin-bottom: var(--spacing-sm);
        }

        .skeleton-line.short {
            width: 60%;
        }

        .skeleton-line.long {
            width: 100%;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        /* 响应式设计 */
        @media (max-width: 600px) {
            .filter-section {
                padding: 10px var(--spacing-md);
            }
            
            .filter-tab {
                padding: 8px var(--spacing-sm);
                font-size: var(--text-body-small);
            }
            
            .activities-section {
                padding: var(--spacing-sm) var(--spacing-md);
            }
            
            .activity-meta {
                gap: 6px;
            }
            
            .meta-item {
                font-size: var(--text-label-large);
            }
            
            .activity-footer {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-sm);
            }
            
            .view-btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="home-page app-container">
            <!-- 顶部导航栏容器 -->
            <div class="top-bar-container"></div>
            
            <!-- 搜索栏容器 -->
            <div class="search-bar-container"></div>

            <main class="page-content">
                <!-- 筛选标签区域 -->
                <section class="filter-section">
                    <div class="filter-tabs">
                        <button 
                            v-for="filter in filters" 
                            :key="filter.key"
                            :class="['filter-tab', { active: activeFilter === filter.key }]"
                            @click="setActiveFilter(filter.key)"
                        >
                            <iconify-icon :icon="filter.icon" class="filter-icon"></iconify-icon>
                            {{ filter.name }}
                        </button>
                    </div>
                </section>

                <!-- 活动列表区域 -->
                <section class="activities-section">
                    <!-- 加载状态 -->
                    <div v-if="loading" class="activity-list">
                        <div v-for="n in 3" :key="n" class="activity-skeleton">
                            <div class="skeleton-image"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-line long"></div>
                                <div class="skeleton-line short"></div>
                                <div class="skeleton-line long"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 活动列表 -->
                    <div v-else class="activity-list">
                        <article 
                            v-for="activity in filteredActivities" 
                            :key="activity.id"
                            class="activity-card"
                            @click="viewActivity(activity)"
                        >
                            <div class="activity-image-container">
                                <img :src="activity.image" :alt="activity.title" class="activity-image" loading="lazy">
                                <div :class="['activity-status', activity.status]">
                                    {{ getStatusText(activity.status) }}
                                </div>
                                <div class="activity-category">
                                    {{ getCategoryText(activity.category) }}
                                </div>
                            </div>
                            
                            <div class="activity-info">
                                <h2 class="activity-title">{{ activity.title }}</h2>
                                
                                <div class="activity-meta">
                                    <div class="meta-item">
                                        <iconify-icon icon="mdi:calendar-outline" class="meta-icon"></iconify-icon>
                                        <span>{{ formatDate(activity.date) }}</span>
                                    </div>
                                    <div class="meta-item">
                                        <iconify-icon icon="mdi:map-marker-outline" class="meta-icon"></iconify-icon>
                                        <span>{{ activity.location }}</span>
                                    </div>
                                    <div class="meta-item" v-if="activity.organizer">
                                        <iconify-icon icon="mdi:account-group-outline" class="meta-icon"></iconify-icon>
                                        <span>{{ activity.organizer }}</span>
                                    </div>
                                </div>
                                
                                <p class="activity-summary">{{ activity.summary }}</p>
                                
                                <div class="activity-footer">
                                    <div class="participants-info">
                                        <iconify-icon icon="mdi:account-multiple-outline" width="16" height="16"></iconify-icon>
                                        <span>{{ activity.participants || 0 }} 人参与</span>
                                    </div>
                                    <button class="view-btn" @click.stop="registerActivity(activity)">
                                        <span v-if="activity.status === 'open'">立即报名</span>
                                        <span v-else-if="activity.status === 'full'">已报满</span>
                                        <span v-else>查看详情</span>
                                        <iconify-icon icon="mdi:arrow-right" width="16" height="16"></iconify-icon>
                                    </button>
                                </div>
                            </div>
                        </article>
                    </div>
                    
                    <!-- 空状态 -->
                    <div v-if="!loading && filteredActivities.length === 0" class="empty-state">
                        <div class="empty-icon">📅</div>
                        <div class="empty-title">暂无活动</div>
                        <div class="empty-message">当前没有符合条件的活动<br>请尝试切换筛选条件或稍后再来</div>
                    </div>
                </section>
            </main>

            <!-- 底部导航栏容器 -->
            <div class="bottom-nav-container"></div>
        </div>

        <!-- 加载指示器容器 -->
        <div class="loader-container"></div>
    </div>

    <script src="shared-components.js"></script>
    <script src="page-loader.js"></script>
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    loading: true,
                    searchQuery: '',
                    activeFilter: 'all',
                    
                    filters: [
                        { key: 'all', name: '全部', icon: 'mdi:view-grid-outline' },
                        { key: 'latest', name: '最新', icon: 'mdi:clock-outline' },
                        { key: 'hot', name: '热门', icon: 'mdi:fire' },
                        { key: 'career', name: '求职', icon: 'mdi:briefcase-outline' },
                        { key: 'social', name: '社交', icon: 'mdi:account-group-outline' },
                        { key: 'academic', name: '学术', icon: 'mdi:school-outline' },
                        { key: 'nanjing', name: '南京', icon: 'mdi:map-marker-outline' },
                        { key: 'shanghai', name: '上海', icon: 'mdi:map-marker-outline' },
                        { key: 'beijing', name: '北京', icon: 'mdi:map-marker-outline' }
                    ],
                    
                    activities: [
                        {
                            id: 1,
                            title: '南京大学2025年毕业生秋季大型双选会',
                            summary: '为2025年毕业生提供优质就业机会，汇聚知名企业现场招聘，涵盖IT、金融、制造业等多个行业，助力毕业生找到心仪工作。',
                            date: '2024-09-27',
                            location: '南京大学体育馆',
                            organizer: '南大就业指导中心',
                            image: 'https://images.unsplash.com/photo-1559136555-9303baea8ebd?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                            status: 'open',
                            category: 'career',
                            region: 'nanjing',
                            participants: 328
                        },
                        {
                            id: 2,
                            title: '校友企业专场招聘会',
                            summary: '邀请优秀校友企业回母校招聘，为学弟学妹提供就业机会，同时加强校友与母校的联系，传承南大精神。',
                            date: '2024-10-15',
                            location: '南京大学逸夫楼',
                            organizer: '校友总会',
                            image: 'https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                            status: 'open',
                            category: 'career',
                            region: 'nanjing',
                            participants: 156
                        },
                        {
                            id: 3,
                            title: '南大校友上海聚会',
                            summary: '在沪校友年度聚会，增进友谊，分享创业经验，探讨行业发展趋势，为校友提供互助合作的平台。',
                            date: '2024-11-03',
                            location: '上海浦东香格里拉酒店',
                            organizer: '上海校友会',
                            image: 'https://images.unsplash.com/photo-1511578314322-379afb476865?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                            status: 'open',
                            category: 'social',
                            region: 'shanghai',
                            participants: 89
                        },
                        {
                            id: 4,
                            title: '南大创业论坛',
                            summary: '邀请知名校友分享创业心得，探讨行业趋势，为有志创业的校友提供指导和资源对接。',
                            date: '2024-08-20',
                            location: '南京大学仙林校区',
                            organizer: '创业校友会',
                            image: 'https://images.unsplash.com/photo-1515187029135-18ee286d815b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                            status: 'closed',
                            category: 'academic',
                            region: 'nanjing',
                            participants: 245
                        },
                        {
                            id: 5,
                            title: '北京校友年会',
                            summary: '北京地区校友年度盛会，回顾过去一年的收获，展望未来发展，加强校友间的合作交流。',
                            date: '2024-12-15',
                            location: '北京国际会议中心',
                            organizer: '北京校友会',
                            image: 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                            status: 'full',
                            category: 'social',
                            region: 'beijing',
                            participants: 420
                        },
                        {
                            id: 6,
                            title: '人工智能前沿学术研讨会',
                            summary: '汇聚AI领域顶尖学者和业界精英，分享最新研究成果，探讨人工智能技术发展趋势和应用前景。',
                            date: '2024-10-28',
                            location: '南京大学计算机系',
                            organizer: '计算机系校友会',
                            image: 'https://images.unsplash.com/photo-1485827404703-89b55fcc595e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                            status: 'open',
                            category: 'academic',
                            region: 'nanjing',
                            participants: 67
                        }
                    ]
                };
            },
            
            computed: {
                filteredActivities() {
                    let filtered = [...this.activities];
                    
                    // 按筛选器过滤
                    if (this.activeFilter === 'latest') {
                        filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
                    } else if (this.activeFilter === 'hot') {
                        filtered.sort((a, b) => b.participants - a.participants);
                    } else if (['career', 'social', 'academic'].includes(this.activeFilter)) {
                        filtered = filtered.filter(activity => activity.category === this.activeFilter);
                    } else if (['nanjing', 'shanghai', 'beijing'].includes(this.activeFilter)) {
                        filtered = filtered.filter(activity => activity.region === this.activeFilter);
                    }
                    
                    // 按搜索关键词过滤
                    if (this.searchQuery.trim()) {
                        const query = this.searchQuery.trim().toLowerCase();
                        filtered = filtered.filter(activity => 
                            activity.title.toLowerCase().includes(query) ||
                            activity.summary.toLowerCase().includes(query) ||
                            activity.location.toLowerCase().includes(query) ||
                            activity.organizer.toLowerCase().includes(query)
                        );
                    }
                    
                    return filtered;
                }
            },
            
            methods: {
                setActiveFilter(filter) {
                    this.activeFilter = filter;
                },
                
                formatDate(dateStr) {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('zh-CN', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        weekday: 'short'
                    });
                },
                
                getStatusText(status) {
                    const statusMap = {
                        open: '报名中',
                        full: '已报满',
                        closed: '已结束'
                    };
                    return statusMap[status] || status;
                },
                
                getCategoryText(category) {
                    const categoryMap = {
                        career: '求职招聘',
                        social: '社交聚会',
                        academic: '学术交流',
                        other: '其他'
                    };
                    return categoryMap[category] || category;
                },
                
                viewActivity(activity) {
                    const statusClass = activity.status === 'open' ? 'open' : 
                                      activity.status === 'full' ? 'full' : 'closed';
                    
                    showBottomSheet(activity.title, `
                        <div>
                            <img src="${activity.image}" 
                                 alt="${activity.title}" 
                                 class="activity-detail-image">
                            
                            <div class="activity-detail-row">
                                <span class="activity-detail-label">时间：</span>
                                <span class="activity-detail-value">${this.formatDate(activity.date)} 周五</span>
                            </div>
                            
                            <div class="activity-detail-row">
                                <span class="activity-detail-label">地点：</span>
                                <span class="activity-detail-value">${activity.location}</span>
                            </div>
                            
                            <div class="activity-detail-row">
                                <span class="activity-detail-label">主办方：</span>
                                <span class="activity-detail-value">${activity.organizer || '南大就业指导中心'}</span>
                            </div>
                            
                            <div class="activity-detail-row">
                                <span class="activity-detail-label">参与人数：</span>
                                <span class="activity-detail-value">${activity.participants || 328} 人</span>
                            </div>
                            
                            <div class="activity-detail-row">
                                <span class="activity-detail-label">状态：</span>
                                <span class="activity-status-badge ${statusClass}">${this.getStatusText(activity.status)}</span>
                            </div>
                            
                            <div class="activity-description">
                                ${activity.summary}
                            </div>
                        </div>
                    `, [
                        { text: '关闭', class: 'outlined-btn' },
                        { 
                            text: activity.status === 'open' ? '立即报名' : '我知道了', 
                            class: 'primary-btn',
                            onclick: activity.status === 'open' ? `registerActivity(${activity.id}, true)` : 'closeBottomSheet(this)'
                        }
                    ], {
                        maxHeight: '85vh'
                    });
                },
                
                registerActivity(activity, fromModal = false) {
                    if (fromModal) {
                        closeBottomSheet(document.querySelector('.bottom-sheet-overlay'));
                    }
                    
                    if (activity.status !== 'open') {
                        if (activity.status === 'full') {
                            showToast('很抱歉，该活动已报满', 'warning');
                        } else {
                            showToast('该活动已结束报名', 'info');
                        }
                        return;
                    }
                    
                    showLoader();
                    
                    // 模拟报名API调用
                    setTimeout(() => {
                        hideLoader();
                        showToast('报名成功！活动信息已发送至消息中心', 'success');
                        
                        // 更新参与人数
                        activity.participants += 1;
                        
                        // 可以在这里跳转到我的活动页面
                        setTimeout(() => {
                            // window.location.href = 'profile.html';
                        }, 1500);
                    }, 1500);
                },
                
                loadActivities() {
                    this.loading = true;
                    
                    // 模拟API加载
                    setTimeout(() => {
                        this.loading = false;
                    }, 1000);
                }
            },
            
            mounted() {
                // 检查登录状态
                if (!localStorage.getItem('alumni_token')) {
                    window.location.href = 'login.html';
                    return;
                }
                
                // 初始化页面组件
                initializePage({
                    title: '校友活动',
                    activePage: 'home',
                    showSearch: true,
                    showNotification: true,
                    searchPlaceholder: '搜索活动、地点或主办方...'
                });
                
                // 监听搜索输入
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.searchQuery = e.target.value;
                    });
                }
                
                // 加载活动数据
                this.loadActivities();
            }
        }).mount('#app');

        // 全局函数用于模态框
        function registerActivity(activityId, fromModal = false) {
            const app = document.getElementById('app').__vue_app__.ctx;
            const activity = app.activities.find(a => a.id === activityId);
            if (activity) {
                app.registerActivity(activity, fromModal);
            }
        }
    </script>
</body>
</html>
